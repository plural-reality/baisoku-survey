倍速アンケート ユーザー仕様書

  1. プロダクト概要

  Sonar（倍速アンケート） は、AIを活用した内省支援・アンケートプラットフォーム。従来のアンケートツール（Google
  Forms等）と異なり、AIが回答者の傾向に応じてリアルタイムに質問を深掘り生成し、最終的に構造化されたレポートを自動生成する。

  2つの利用モードが存在する：

  ┌──────────────────┬────────────────────────┬──────────────────────────┐
  │      モード      │          対象          │           入口           │
  ├──────────────────┼────────────────────────┼──────────────────────────┤
  │ ソロモード       │ 個人の思考整理         │ /solo                    │
  ├──────────────────┼────────────────────────┼──────────────────────────┤
  │ プリセットモード │ 組織向けアンケート配布 │ /create → /preset/[slug] │
  └──────────────────┴────────────────────────┴──────────────────────────┘

  ---
  2. 画面一覧と詳細仕様

  2.1 ランディングページ (/lp)

  目的: サービスの訴求・新規ユーザー獲得

  構成セクション (上から順):
  1. LPHeader — スティッキーヘッダー。スクロールで背景がblur付きに変化
  2. HeroSection — メインキャッチコピー「アンケートを、倍速で。」+ 製品デモアニメーション
  3. PainPointsSection — 従来ツールの課題提示
  4. HowItWorksSection — 使い方ステップ解説
  5. UIShowcaseSection — UI実画面のショーケース
  6. FeaturesSection — 機能紹介
  7. ComparisonSection — 他ツール比較表
  8. UseCasesSection — 活用例
  9. PricingSection — 料金プラン
  10. FAQSection — よくある質問（アコーディオン）
  11. FinalCTA — 最終行動喚起
  12. LPFooter — フッター（pills スタイル）

  特記: LPは常にライトモード強制（className="light"）。ダークモードの影響を受けない。

  ---
  2.2 ホームページ / ダッシュボード (/)

  アクセス条件: ログイン必須（未ログインはリダイレクト）

  構成:
  - AppHeader — ロゴ「倍速アンケート」 + テーマ切替 + ユーザーメール表示・ログアウト
  - 新規作成エリア — Google Forms風の「+」ボタンカード（/createへリンク）
  - アンケート一覧（PresetList） — Google Forms風グリッドレイアウト（2列/3列）。各カード上部にブルーのカラーバー。タイトル・目的・日付・回答数を表示。クリックで
  /manage/[slug] へ遷移

  ---
  2.3 アンケート作成ページ (/create)

  アクセス条件: ログイン推奨（非ログインでも表示）

  構成: PresetCreator コンポーネントによるフォーム。3つのfieldsetで構成：

  fieldset 1: 回答者に表示される情報（緑系ボーダー）

  - タイトル — 必須テキスト入力
  - 説明文 — 任意テキストエリア + 「AIで生成する」ボタン
  - PDFアップロード — PDFから背景情報を抽出

  fieldset 2: 固定質問（青系ボーダー）

  - Google Forms風の質問エディタ
  - 質問タイプ選択: ラジオボタン / チェックボックス / プルダウン / 短文テキスト / 段落テキスト / 均等目盛
  - 各質問に選択肢を追加（最大10個、最低2個）
  - 均等目盛はmin/max値 + 左右ラベル設定可能
  - ドラッグ＆ドロップ不要（削除ボタンのみ）

  fieldset 3: AI深掘り設定（紫系ボーダー）

  - 深掘りの目的 — 必須テキストエリア
  - 探索テーマ — 任意リスト + 「AIで生成する」ボタン + ドラッグ＆ドロップ並べ替え

  詳細設定（折りたたみ）

  - レポートのカスタマイズ — 任意テキストエリア
  - 質問数 — 5問刻みドロップダウン（5〜95問、デフォルト10問）

  送信後: /manage/[slug] へリダイレクト

  ---
  2.4 ソロモードページ (/solo)

  目的: 個人が1人でAIと壁打ちして思考を整理

  構成:
  - ヘッダー — 「1人で壁打ちする」タイトル + サブテキスト
  - SessionForm — 目的入力（必須）+ 背景情報（任意）+ PDFアップロード + 詳細設定（回答数選択）
  - SessionList — ローカルストレージに保存された過去セッション一覧

  ---
  2.5 ログインページ (/login)

  構成:
  - 画面中央配置のカード
  - メールアドレス入力フォーム
  - 「マジックリンクを送信」ボタン
  - 送信後: メール確認メッセージ表示（✉️ アイコン付き）
  - 右上にテーマ切替ボタン

  ---
  2.6 セッションページ (/session/[id])

  3つの表示モード:

  通常モード

  - ページ上部: セッションタイトル（session.title || session.purpose）
  - QuestionFlow コンポーネントで全フロー管理

  音声モード (?mode=voice)

  - フルスクリーン白背景
  - VoiceQuestionFlow — 音声入力対応の専用UI

  ボートマッチモード（タイトルが「2026年の衆議院選挙 ボートマッチ」の場合）

  - VotematchSession — 選挙ボートマッチ専用UI

  ---
  2.7 QuestionFlow — 質問回答フローの詳細

  進捗バー: ページ上部にスティッキー固定。current / total 表示 + ブルーのプログレスバー

  質問カード (QuestionCard):

  AI生成質問の回答UIは独自の3+1構造:

  ┌─────────────────────────────────────┐
  │ Q1. [質問文]                          │
  │ [補足説明]                            │
  │                                     │
  │ ┌────┐ ┌────────┐ ┌─────┐          │
  │ │ ✓  │ │ ?      │ │ ✕   │          │
  │ │はい│ │わからない│ │いいえ│          │
  │ └────┘ └────────┘ └─────┘          │
  │                                     │
  │ ┌─────────────────────────────┐     │
  │ │ ··· どちらでもない ▼        │     │
  │ └─────────────────────────────┘     │
  │   └→ [展開時]                       │
  │      ○ AIが予測した中間的立場1       │
  │      ○ AIが予測した中間的立場2       │
  │      ○ AIが予測した中間的立場3       │
  │      ────────────────              │
  │      □ 自由記述 [テキストエリア]      │
  │      [送信する]                     │
  └─────────────────────────────────────┘

  - はい: 緑系（emerald）
  - わからない: 琥珀系（amber）
  - いいえ: ローズ系（rose）
  - どちらでもない: スレート系（slate）、展開/折りたたみ式
    - サブ選択肢3つ（options[3-5]）
    - 自由記述（option[6]）：バイオレット系（violet）

  固定質問は通常のラジオボタンリスト（青系ハイライト）。チェックボックス/ドロップダウン/テキスト/均等目盛も対応。

  セクション分割: 固定質問とAI質問の間に区切り線
  - 「共通質問 — 全員に同じ質問をしています」
  - 「AIによる深掘り質問 — あなたの回答をもとに質問を生成しています」

  分析ブロック (AnalysisBlock):
  - 5問ごとに表示
  - グラデーション背景（from-blue-50 to-indigo-50）
  - 青いアイコン（電球）+ 「分析 #N（QX-QY）」ヘッダー

  完了バナー (finish-banner):
  - 目標問数到達時に表示
  - グラデーション背景（from-blue-50 to-indigo-50）
  - 「X問の回答が完了しました」+ 「回答を終えて結果を見る」ボタン
  - 「もっと深掘りする（さらに5問追加）」リンク

  レポートモーダル:
  - レポート生成完了時に表示
  - 半透明黒背景 + backdrop-blur
  - モーダルカード: ヘッダー（タイトル・バージョン・アクションボタン群）+ Markdownレポート本文 + フッター
  - アクションボタン: 「全文を別タブで開く」「リンクをコピー」「MDをコピー」
  - フッターボタン: 「閉じて回答を続ける」
  - レポート内の [Q番号] はインタラクティブな引用カード（QuestionCitation）に変換

  ページ最下部: 「未回答の質問へ（残りN件）」ボタン（ページ最下部到達時のみ表示）

  ヘッダーの追加ボタン:
  - 目標到達前: 「回答を中断する」（ボーダーのみの控えめなボタン）
  - 目標到達後: 「回答を終えて結果を見る」（青いプライマリボタン）

  ---
  2.8 レポートページ (/report/[id])

  構成:
  - ヘッダー: 「診断レポート」+ バージョン番号
  - アクションボタン: 「シェア」（Web Share API対応、非対応時はコピー）+ 「回答を続ける」
  - 回答ログ: 折りたたみ式。回答済み全質問の一覧（Q番号・質問文・選択した回答）
  - AIレポート: 白カード内にMarkdownレンダリング。[Q番号] は引用カードに変換
  - 引用カードはホバーで質問内容とユーザーの回答を表示

  ---
  2.9 印刷用レポート (/report/[id]/print)

  - @media print 対応の専用レイアウト
  - .no-print / .print-only クラスで要素の表示/非表示制御
  - 白背景・黒文字・11ptフォント・2cm余白

  ---
  2.10 プリセットページ (/preset/[slug])

  動作: アクセスと同時に自動的にセッションを作成し、/session/[id] にリダイレクト。ユーザーに待ち画面は表示されない（エラー時のみエラーメッセージ表示）。

  OGP対応: generateMetadata でプリセットごとのtitle/description/image設定。

  ---
  2.11 管理画面 (/manage/[slug])

  アクセス条件: ログイン必須 + プリセット所有者のみ

  構成: ManageTabs コンポーネント。認証ベースでadmin_tokenを取得し、回答一覧・集約レポートなどの管理機能を提供。

  ---
  2.12 レガシー管理画面 (/admin/[token])

  アクセス: トークンベース（URLにトークン埋め込み）

  構成: AdminDashboard コンポーネント。SEOで noindex/nofollow。

  ---
  3. 見た目・トーン＆マナー

  3.1 カラーパレット

  ┌────────────────────────┬────────────────────┬─────────────────────┐
  │          用途          │    ライトモード    │    ダークモード     │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ 背景                   │ #f9fafb (gray-50)  │ #0f172a (slate-900) │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ テキスト               │ #111827 (gray-900) │ #e2e8f0 (slate-200) │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ カード背景             │ #ffffff            │ #1e293b (slate-800) │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ ミュートテキスト       │ #6b7280 (gray-500) │ #94a3b8 (slate-400) │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ ボーダー               │ #e5e7eb (gray-200) │ #334155 (slate-700) │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ プライマリ             │ #2563eb (blue-600) │ 同左                │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ 成功（はい）           │ emerald-500        │ 同左                │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ 警告（わからない）     │ amber-500          │ 同左                │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ エラー（いいえ）       │ rose-500           │ 同左                │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ 中立（どちらでもない） │ slate-400          │ 同左                │
  ├────────────────────────┼────────────────────┼─────────────────────┤
  │ 自由記述               │ violet-500         │ 同左                │
  └────────────────────────┴────────────────────┴─────────────────────┘

  3.2 タイポグラフィ

  - フォントファミリー: Geist Sans（CSS変数 --font-geist-sans）+ システムフォントフォールバック
  - ロゴ: 太字イタリック + skewX(-6deg) の斜体変形 + tracking-tighter
  - 見出し: font-bold / font-semibold
  - 本文: text-sm (14px) が基本
  - レポート本文: prose クラスで段落・リスト・見出しのスペーシングを統一

  3.3 デザインパターン

  - 角丸:
    - カード: rounded-xl (12px) / rounded-2xl (16px)
    - ボタン: rounded-lg (8px) / rounded-xl (12px)
    - プログレスバー: rounded-full
    - ラジオインジケーター: rounded-full
  - シャドウ: shadow-sm が基本。ホバー時に shadow-md / shadow-lg に昇格
  - ボーダー: 1pxの薄いボーダーが基本。選択状態は border-2
  - レスポンシブ: スマホファースト。sm: / md: ブレークポイントで横並び化
  - ダークモード: ThemeProvider でシステム設定に追従。CSS変数ベース。Tailwindのグレースケールをダークモード用に反転

  3.4 全体的なトーン

  - クリーン・ミニマル: 余白を活かした設計。装飾は最小限
  - Google Forms的: ダッシュボードのカードグリッド、質問エディタのUI
  - プロフェッショナル: 青を基調とした信頼感のあるカラースキーム
  - 日本語ファースト: エラーメッセージ・ラベル・プレースホルダすべて日本語

  ---
  4. ボタン構成

  4.1 プライマリボタン

  bg-blue-600 text-white rounded-lg font-medium
  hover:bg-blue-700 transition-colors
  disabled:opacity-50 disabled:cursor-not-allowed
  - 使用箇所: 「セッションを開始する」「アンケートを作成する」「マジックリンクを送信」「回答を終えて結果を見る」「無料で始める」
  - フルwidth（モバイル）/ auto（デスクトップ）

  4.2 セカンダリ/アウトラインボタン

  border border-gray-300 text-gray-600 rounded-lg
  hover:bg-gray-100 transition-colors
  - 使用箇所: 「回答を中断する」「シェア」「使い方を見る」

  4.3 回答ボタン（AI質問）

  3つの主回答ボタンが横並び（flex-1）:
  - はい: emerald系。チェックマークアイコン
  - わからない: amber系。?マークアイコン
  - いいえ: rose系。×マークアイコン
  - どちらでもない: slate系。三点アイコン + シェブロン。フルwidth

  4.4 ラジオ/チェックボックスボタン（固定質問）

  w-full text-left px-4 py-3 rounded-xl border-2
  → 選択時: border-blue-500 bg-blue-50 text-blue-800 shadow-sm
  → 未選択: border-gray-200 text-gray-700 hover:bg-gray-50
  - 左端に丸いインジケーター（ラジオ: rounded-full, チェックボックス: rounded）

  4.5 均等目盛ボタン

  w-10 h-10 rounded-full border-2
  → 選択時: border-blue-500 bg-blue-500 text-white
  → 未選択: border-gray-300 bg-white text-gray-700

  4.6 小さいアクションボタン

  px-3 py-1.5 border border-gray-200 rounded-lg text-xs text-gray-600
  hover:bg-gray-50 transition-colors
  - 使用箇所: 「全文を別タブで開く」「リンクをコピー」「MDをコピー」

  4.7 テキストリンクボタン

  text-sm text-gray-500 hover:text-blue-600 underline underline-offset-2
  - 使用箇所: 「もっと深掘りする（さらに5問追加）」

  4.8 AI生成ボタン

  text-xs px-3 py-1.5 bg-purple-50 text-purple-700 border border-purple-200 rounded-lg
  hover:bg-purple-100 disabled:opacity-50
  - 使用箇所: 「AIで生成する」（探索テーマ、背景情報）

  4.9 破線追加ボタン

  w-full py-3 border-2 border-dashed border-blue-200 rounded-lg
  text-sm text-blue-600 hover:bg-blue-50
  - 使用箇所: 「+ 質問を追加」

  ---
  5. アニメーション・トランジションの挙動

  5.1 CSSアニメーション（@keyframes）

  ┌────────────┬────────────────────────────────────┬────────────────────────────────┐
  │    名前    │                効果                │              用途              │
  ├────────────┼────────────────────────────────────┼────────────────────────────────┤
  │ lp-fade-up │ translateY(32px) → 0 + opacity 0→1 │ LP各セクションのスクロール出現 │
  ├────────────┼────────────────────────────────────┼────────────────────────────────┤
  │ lp-fade-in │ opacity 0→1                        │ LP要素のフェードイン           │
  └────────────┴────────────────────────────────────┴────────────────────────────────┘

  5.2 Tailwindアニメーション

  ┌──────────────────────┬─────────────────────┬───────────────────────────────────────────┐
  │        クラス        │        効果         │                   用途                    │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ animate-pulse        │ 点滅（opacity変化） │ スケルトンローディング、ステータスドット  │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ animate-spin         │ 360度回転           │ ローディングスピナー（SVG circle）        │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ transition-colors    │ 色の変化            │ 全ボタンのhover/focus                     │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ transition-all       │ 全プロパティ        │ ボタン選択、ヘッダー背景変化              │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ transition-transform │ transform変化       │ シェブロン回転（折りたたみ）              │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ duration-200         │ 200ms               │ ボタン・カード                            │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ duration-300         │ 300ms               │ プログレスバー、ヘッダー、展開/折りたたみ │
  ├──────────────────────┼─────────────────────┼───────────────────────────────────────────┤
  │ duration-500         │ 500ms               │ LPステージインジケーター                  │
  └──────────────────────┴─────────────────────┴───────────────────────────────────────────┘

  5.3 インタラクション詳細

  ┌────────────┬──────────────────────┬────────────────────────────────────────────────────────────────────────────────────┐
  │  トリガー  │         対象         │                                        挙動                                        │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ ホバー     │ カード（PresetList） │ border-blue-300 + shadow-md に変化                                                 │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ ホバー     │ 「+」ボタン          │ アイコンが text-blue-500 に変色 + shadow-md                                        │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ ホバー     │ ナビリンク           │ text-muted-foreground → text-foreground                                            │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ ホバー     │ LPのCTAボタン        │ shadow-lg shadow-blue-600/20 追加                                                  │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ クリック   │ 回答選択             │ ボーダー色変化 + 背景色変化（200ms）                                               │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ クリック   │ 「どちらでもない」   │ サブ選択肢エリアが max-h-0 → max-h-[600px] でスライドオープン（300ms ease-in-out） │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ クリック   │ 詳細設定             │ シェブロンが rotate-90 で回転                                                      │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ クリック   │ 回答ログ             │ シェブロンが rotate-180 で回転                                                     │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ スクロール │ LPヘッダー           │ bg-transparent → bg-background/90 backdrop-blur-xl shadow-sm                       │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ スクロール │ セクション出現（LP） │ lp-fade-up アニメーション                                                          │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ 自動       │ ヒーローデモ         │ 4ステージ自動切替（3.5s→3s→4s→4s）。ステージインジケーターが w-1.5 → w-8 に伸縮    │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ 自動       │ 分析完了             │ 分析ブロックまで scrollIntoView({ behavior: "smooth" })                            │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ Focus      │ 入力フィールド       │ ring-2 ring-blue-500 / ring-purple-500 / ring-green-500                            │
  ├────────────┼──────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
  │ Disabled   │ 全ボタン             │ opacity-50 cursor-not-allowed                                                      │
  └────────────┴──────────────────────┴────────────────────────────────────────────────────────────────────────────────────┘

  5.4 ローディング状態

  ┌────────────────┬──────────────────────────────────────────────────────────┐
  │      状態      │                           表示                           │
  ├────────────────┼──────────────────────────────────────────────────────────┤
  │ 質問生成中     │ QuestionSkeleton ×5（animate-pulse の灰色矩形）          │
  ├────────────────┼──────────────────────────────────────────────────────────┤
  │ 分析生成中     │ AnalysisSkeleton（animate-pulse）                        │
  ├────────────────┼──────────────────────────────────────────────────────────┤
  │ レポート生成中 │ SVGスピナー（animate-spin）+ 「結果を分析中...」テキスト │
  ├────────────────┼──────────────────────────────────────────────────────────┤
  │ ボタン送信中   │ テキストが「送信中...」「作成中...」等に変化 + disabled  │
  ├────────────────┼──────────────────────────────────────────────────────────┤
  │ ページ読込中   │ プログレスバー 0/N + スケルトン5枚                       │
  └────────────────┴──────────────────────────────────────────────────────────┘

  5.5 アクセシビリティ

  - prefers-reduced-motion: reduce 対応: 全アニメーションのdurationを0.01msに短縮
  - scroll-behavior: smooth: HTML要素に設定
  - Focus visible: 全要素に outline: 2px solid #3b82f6 + outline-offset: 2px

  ---
  6. 機能フロー詳細

  6.1 メインフロー（ソロモード）

  [/solo] 目的入力
    → POST /api/sessions（セッション作成）
    → [/session/:id] 最初の5問自動生成
    → 5問回答完了
    → 分析生成 + 次の5問生成（並列）
    → 繰り返し...
    → 目標問数到達
    → 「回答を終えて結果を見る」
    → レポート生成
    → レポートモーダル表示
    → [/report/:id] でも閲覧可能

  6.2 プリセットフロー（組織向け）

  [管理者] /create → アンケート作成
    → /manage/[slug] で管理
    → 回答用URL (/preset/[slug]) を配布

  [回答者] /preset/[slug] にアクセス
    → 自動セッション作成 → /session/:id にリダイレクト
    → 固定質問に回答（セクション区切り付き）
    → AI深掘り質問に回答
    → 目標到達 → レポート生成

  [管理者] /manage/[slug] で全回答閲覧・集約レポート確認

  6.3 フェーズシステム

  ┌───────────────────┬─────────────────────────────────────┬───────────────────┐
  │      バッチ       │              フェーズ               │       内容        │
  ├───────────────────┼─────────────────────────────────────┼───────────────────┤
  │ Batch 1-2 (Q1-10) │ exploration                         │ テーマを広く網羅  │
  ├───────────────────┼─────────────────────────────────────┼───────────────────┤
  │ Batch 3+          │ deep-dive → reframing → exploration │ 3フェーズ繰り返し │
  └───────────────────┴─────────────────────────────────────┴───────────────────┘

  6.4 認証フロー

  /login → メールアドレス入力
    → Supabase Auth OTP送信
    → Mailpit（ローカル）/ 実メール（本番）でリンク確認
    → /auth/confirm → PKCE code交換
    → リダイレクト先へ

  ---
  この仕様書が、プロダクトの全画面・全機能・デザインシステム・アニメーション挙動を網羅しています。追加で深掘りしたい箇所があれば指定してください。
